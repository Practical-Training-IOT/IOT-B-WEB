/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{i as t}from"./087AC4D233B64EB0index.CZ5cmnbN.js";import{_ as a,c as e,o as s}from"./087AC4D233B64EB0index.CO5TVuii.js";const i={ref:"chart",style:{height:"400px"}};const n=a({data:()=>({chartInstance:null,loading:!1,error:null,trafficData:[]}),mounted(){this.initChart(),this.fetchData(),this.interval=setInterval(this.fetchData,5e3),this.socket=new WebSocket("ws://localhost:8084/ws"),this.socket.onmessage=t=>{const a=JSON.parse(t.data);this.updateChartWithRealData(a)}},methods:{initChart(){this.chartInstance=t(this.$refs.chart),this.chartInstance.setOption({title:{text:"网络流量"},tooltip:{trigger:"axis"},legend:{data:["上行","下行"]},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} KB"}},series:[{name:"上行",type:"line",data:[]},{name:"下行",type:"line",data:[]}]});const a={timestamp:Date.now(),netBytesSent:500,netBytesRecv:300};this.updateChartData(a)},async fetchData(){try{this.loading=!0;const t=await fetch("http://localhost:8084/api/metrics/latest");if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));const a=await t.json();this.updateChartData(a)}catch(t){this.error="获取数据失败"}finally{this.loading=!1}},updateChartData(t){if(!this.chartInstance||!t)return;const a=this.chartInstance.getOption(),e=[...a.xAxis[0].data,new Date(t.timestamp).toLocaleTimeString()],s=[...a.series[0].data,t.netBytesSent/1024],i=[...a.series[1].data,t.netBytesRecv/1024];e.length>60&&(e.shift(),s.shift(),i.shift()),this.chartInstance.setOption({xAxis:{data:e},series:[{data:s},{data:i}]})},updateChartWithRealData(t){this.chartInstance&&t&&this.updateChartData(t)},handleResize(){this.chartInstance&&this.chartInstance.resize()}},beforeUnmount(){this.interval&&clearInterval(this.interval),this.socket&&this.socket.close(),window.removeEventListener("resize",this.handleResize),this.chartInstance&&this.chartInstance.dispose()}},[["render",function(t,a,n,r,h,c){return s(),e("div",i,null,512)}]]);export{n as default};
