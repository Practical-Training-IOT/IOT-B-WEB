/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{i as t,f as e}from"./087AC4D233B64EB0index.CZ5cmnbN.js";import{_ as a,C as s,c as i,o as r,b as l,t as c,n,F as o,D as m}from"./087AC4D233B64EB0index.CO5TVuii.js";const h={class:"system-metrics"},d={class:"top-metrics"},u={class:"metric-card"},p={class:"metric-card"},y={class:"metric-card"},f={class:"metric-card"},g={class:"chart-container"},v={class:"chart-title"},C={class:"time-range"},k=["onClick"],b={ref:"trafficChart",class:"chart"},x={class:"charts"},T={class:"chart-container"},D={class:"chart-title"},U={class:"time-range"},R=["onClick"],_={ref:"cpuChart",class:"chart"},w={class:"chart-container"},B={class:"chart-title"},L={class:"time-range"},z=["onClick"],S={ref:"memoryChart",class:"chart"};const H=a({data:()=>({cpuUsage:0,memoryUsed:0,memoryTotal:0,systemLoad:0,diskUsed:0,diskTotal:0,netBytesRecv:0,netBytesSent:0,timestamp:"",isUpstream:!0,selectedTimeRange:"hour",loading:!1,error:null,timeRanges:[{label:"最近一小时",value:"hour"},{label:"最近24小时",value:"day"},{label:"近一周",value:"week"}],trafficData:[],cpuData:[],memoryData:[],socket:null,intervalId:null,formattedTimestamp:""}),mounted(){this.fetchMetrics(),this.initCharts(),this.setupWebSocket(),this.intervalId=setInterval(this.fetchMetrics,5e3),window.addEventListener("resize",this.handleResize)},beforeUnmount(){clearInterval(this.intervalId),this.socket&&this.socket.close(),window.removeEventListener("resize",this.handleResize)},methods:{async fetchMetrics(){this.loading=!0,this.error=null;try{const t=(await s.get("http://localhost:8084/api/metrics/latest")).data;this.cpuUsage=parseFloat(t.cpu_usage)||0,this.memoryUsed=(parseFloat(t.memory_usage)*parseFloat(this.memoryTotal)/100).toFixed(2)||0,this.memoryTotal=16,this.systemLoad=this.cpuUsage,this.diskUsed=(50*parseFloat(t.disk_usage)/100).toFixed(2)||0,this.diskTotal=50,this.netBytesRecv=t.net_bytes_recv||0,this.netBytesSent=t.net_bytes_sent||0,this.timestamp=t.timestamp||"",this.fetchHistoricalData()}catch(t){this.error="获取数据失败，请稍后重试"}finally{this.loading=!1}},async fetchHistoricalData(){try{const t=(await s.get("http://localhost:8084/api/metrics/historical?range=".concat(this.selectedTimeRange))).data;this.trafficData=t.traffic,this.cpuData=t.cpu,this.memoryData=t.memory,this.updateCharts()}catch(t){}},handleResize(){this.$nextTick((()=>{this.trafficChart&&this.trafficChart.resize(),this.cpuChart&&this.cpuChart.resize(),this.memoryChart&&this.memoryChart.resize()}))},initCharts(){this.trafficChart=t(this.$refs.trafficChart),this.cpuChart=t(this.$refs.cpuChart),this.memoryChart=t(this.$refs.memoryChart),this.updateCharts()},updateCharts(){const t=t=>"number"==typeof t&&10===t.toString().length?new Date(1e3*t):new Date(t),a=e=>e&&e.length&&!e.some((t=>void 0===t.value||t.value.length<2))?"".concat(t(e[0].value[0]).toLocaleString("zh-CN"),"<br/>").concat(e.map((t=>"".concat(t.seriesName,": ").concat(t.value[1]))).join("<br/>")):"",s={title:{text:"网络流量"},tooltip:{trigger:"axis",formatter:a},xAxis:{type:"time",boundaryGap:!1,axisLabel:{formatter:function(t,a){return e("yyyy-MM-dd HH:mm:ss",t)}},data:this.trafficData.map((e=>t(e.timestamp)))},yAxis:{type:"value"},series:[{name:"上行",type:"line",data:this.trafficData.map((e=>[t(e.timestamp),e.net_bytes_sent]))},{name:"下行",type:"line",data:this.trafficData.map((e=>[t(e.timestamp),e.net_bytes_recv]))}]},i={title:{text:"CPU 使用率趋势"},tooltip:{trigger:"axis",formatter:a},xAxis:{type:"time",boundaryGap:!1,axisLabel:{formatter:function(t,a){return e("yyyy-MM-dd HH:mm:ss",t)}},data:this.cpuData.map((e=>t(e.timestamp)))},yAxis:{type:"value"},series:[{name:"CPU 使用率",type:"line",data:this.cpuData.map((e=>[t(e.timestamp),e.cpu_usage]))}]},r={title:{text:"内存使用量趋势"},tooltip:{trigger:"axis",formatter:a},xAxis:{type:"time",boundaryGap:!1,axisLabel:{formatter:function(t,a){return e("yyyy-MM-dd HH:mm:ss",t)}},data:this.memoryData.map((e=>t(e.timestamp)))},yAxis:{type:"value"},series:[{name:"内存使用量",type:"line",data:this.memoryData.map((e=>[t(e.timestamp),e.memory_usage]))}]};this.$nextTick((()=>{this.trafficChart.setOption(s),this.cpuChart.setOption(i),this.memoryChart.setOption(r)}))},toggleTraffic(t){this.isUpstream="up"===t,this.updateCharts()},selectTimeRange(t){this.selectedTimeRange=t,this.fetchHistoricalData()},setupWebSocket(){this.socket=new WebSocket("ws://localhost:8084/ws"),this.socket.onmessage=t=>{const e=JSON.parse(t.data);this.cpuUsage=e.cpu_usage;let a=new Date(e.timestamp);"number"==typeof e.timestamp&&10===e.timestamp.toString().length&&(a=new Date(1e3*e.timestamp));this.formattedTimestamp=a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},this.socket.onopen=()=>{},this.socket.onerror=t=>{},this.socket.onclose=t=>{}}}},[["render",function(t,e,a,s,H,M){return r(),i(o,null,[e[9]||(e[9]=l("h3",null,"最新时间",-1)),l("p",null,c(H.formattedTimestamp),1),l("div",h,[l("div",d,[l("div",u,[e[2]||(e[2]=l("h3",null,"CPU 使用率",-1)),l("p",null,c(H.cpuUsage)+" %",1)]),l("div",p,[e[3]||(e[3]=l("h3",null,"内存占用",-1)),l("p",null,c(H.memoryUsed)+" GB",1),l("small",null,"内存总量 "+c(H.memoryTotal)+" GB",1)]),l("div",y,[e[4]||(e[4]=l("h3",null,"系统负载率",-1)),l("p",null,c(H.systemLoad)+" %",1)]),l("div",f,[e[5]||(e[5]=l("h3",null,"磁盘占用",-1)),l("p",null,c(H.diskUsed)+" GB",1),l("small",null,"磁盘总量 "+c(H.diskTotal)+" GB",1)])]),l("div",g,[l("div",v,[e[6]||(e[6]=l("span",null,"网络流量",-1)),l("button",{class:n({active:H.isUpstream}),onClick:e[0]||(e[0]=t=>M.toggleTraffic("up"))},"上行",2),l("button",{class:n({active:!H.isUpstream}),onClick:e[1]||(e[1]=t=>M.toggleTraffic("down"))},"下行",2),l("div",C,[(r(!0),i(o,null,m(H.timeRanges,(t=>(r(),i("button",{key:t.value,class:n({active:H.selectedTimeRange===t.value}),onClick:e=>M.selectTimeRange(t.value)},c(t.label),11,k)))),128))])]),l("div",b,null,512)]),l("div",x,[l("div",T,[l("div",D,[e[7]||(e[7]=l("span",null,"CPU 使用率趋势",-1)),l("div",U,[(r(!0),i(o,null,m(H.timeRanges,(t=>(r(),i("button",{key:t.value,class:n({active:H.selectedTimeRange===t.value}),onClick:e=>M.selectTimeRange(t.value)},c(t.label),11,R)))),128))])]),l("div",_,null,512)]),l("div",w,[l("div",B,[e[8]||(e[8]=l("span",null,"内存使用量趋势",-1)),l("div",L,[(r(!0),i(o,null,m(H.timeRanges,(t=>(r(),i("button",{key:t.value,class:n({active:H.selectedTimeRange===t.value}),onClick:e=>M.selectTimeRange(t.value)},c(t.label),11,z)))),128))])]),l("div",S,null,512)])])])],64)}],["__scopeId","data-v-f54bd6c5"]]);export{H as default};
