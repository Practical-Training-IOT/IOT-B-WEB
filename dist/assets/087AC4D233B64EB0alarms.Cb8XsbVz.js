/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{a as e,M as l,r as a,g as t,N as u,c as r,o as d,f as i,b as o,w as n,h as s,t as v,v as p,d as m,F as c,i as b,m as g,I as f,O as y,R as _,D as h,S as w,P as V,E as C}from"./087AC4D233B64EB0index.CO5TVuii.js";import{g as k,a as T,b as A,f as D,c as U,u as j,d as x,e as N}from"./087AC4D233B64EB0alarms.BAzRKnSt.js";import{_ as z}from"./087AC4D233B64EB0rich-edit.ylmqdvQl.js";import{_ as B}from"./087AC4D233B64EB0rich-view.B-1ov_xT.js";import{u as I}from"./087AC4D233B64EB0btnAuth.C6tLskk0.js";import"./087AC4D233B64EB0image.DZXThNBc.js";const P={style:{width:"300px",height:"300px"}},q={ref:"alarmChart",style:{width:"100%",height:"100%"}},E={class:"gva-search-box"},L={class:"gva-table-box"},M={class:"gva-btn-list"},S={class:"gva-pagination"},F={class:"flex justify-between items-center"},R={class:"text-lg"},K=Object.assign({name:"Alarms"},{__name:"alarms",setup(K){const O=I(),G=e(!1),H=l(),J=e(!1),Q=e([]),W=e([]),X=e([]),Y=e([]),Z=e([]),$=e([]),ee=e([]),le=e([]),ae=e([]),te=e([]),ue=e([]),re=e([]),de=e([]),ie=e({ruleName:"",alarmType:"",alarmLevel:"",ruleDescription:"",triggerMode:"",valueType:"",valuePeriod:"",judgingCondition:"",value:"",silencePeriod:"",meanNotification:"",status:"",product:"",equipment:""}),oe=a({ruleName:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],alarmType:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],alarmLevel:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],triggerMode:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],valueType:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],valuePeriod:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],judgingCondition:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],value:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}]}),ne=a({CreatedAt:[{validator:(e,l,a)=>{ge.value.startCreatedAt&&!ge.value.endCreatedAt?a(new Error("请填写结束日期")):!ge.value.startCreatedAt&&ge.value.endCreatedAt?a(new Error("请填写开始日期")):ge.value.startCreatedAt&&ge.value.endCreatedAt&&(ge.value.startCreatedAt.getTime()===ge.value.endCreatedAt.getTime()||ge.value.startCreatedAt.getTime()>ge.value.endCreatedAt.getTime())?a(new Error("开始日期应当早于结束日期")):a()},trigger:"change"}]}),se=e(),ve=e(),pe=e(1),me=e(0),ce=e(10),be=e([]),ge=e({});let fe=0;const ye=()=>{ge.value={},Ve()},_e=()=>{var e;null==(e=ve.value)||e.validate((async e=>{e&&(pe.value=1,Ve())}))},he=e=>{ce.value=e,Ve()},we=e=>{pe.value=e,Ve()},Ve=async()=>{const e=await k({page:pe.value,pageSize:ce.value,...ge.value});0===e.code&&(be.value=e.data.list,me.value=e.data.total,pe.value=e.data.page,ce.value=e.data.pageSize)};Ve();(async()=>{const e=await T();if(0===e.code){const l=e.data.list;te.value=l.map((e=>({label:e.productName,value:e.ID}))),ue.value=e.data.apiProductMap}})();(async()=>{const e=await A(fe);0===e.code&&(re.value=[{label:e.data.drive_name,value:e.data.ID}],de.value={[e.data.ID]:e.data})})();(async()=>{Q.value=await w("judging_condition"),W.value=await w("mean_notification"),X.value=await w("alert_type"),Y.value=await w("silence_period"),Z.value=await w("Rule_status"),$.value=await w("alert_level"),ee.value=await w("trigger_type"),le.value=await w("value_type"),ae.value=await w("value_period")})();const Ce=e([]),ke=e=>{Ce.value=e},Te=async()=>{V.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=[];if(0===Ce.value.length)return void C({type:"warning",message:"请选择要删除的数据"});Ce.value&&Ce.value.map((l=>{e.push(l.ID)}));0===(await N({IDs:e})).code&&(C({type:"success",message:"删除成功"}),be.value.length===e.length&&pe.value>1&&pe.value--,Ve())}))},Ae=e(""),De=async e=>{0===(await x({ID:e.ID})).code&&(C({type:"success",message:"删除成功"}),1===be.value.length&&pe.value>1&&pe.value--,Ve())},Ue=e(!1),je=()=>{Ue.value=!1,ie.value={ruleName:"",alarmType:"",alarmLevel:"",ruleDescription:"",triggerMode:"",valueType:"",valuePeriod:"",judgingCondition:"",value:"",silencePeriod:"",meanNotification:"",status:"",product:"",equipment:""}},xe=async()=>{var e;G.value=!0,null==(e=se.value)||e.validate((async e=>{if(!e)return G.value=!1;let l;switch(Ae.value){case"create":default:l=await U(ie.value);break;case"update":l=await j(ie.value)}G.value=!1,0===l.code&&(C({type:"success",message:"创建/更改成功"}),je(),Ve())}))},Ne=e({}),ze=e(!1),Be=async e=>{const l=await D({ID:e.ID});0===l.code&&(Ne.value=l.data,ze.value=!0)},Ie=()=>{ze.value=!1,Ne.value={}};return(e,l)=>{const a=t("el-descriptions-item"),w=t("el-descriptions"),C=t("el-drawer"),k=t("QuestionFilled"),T=t("el-icon"),A=t("el-tooltip"),U=t("el-date-picker"),j=t("el-form-item"),x=t("el-button"),N=t("el-form"),I=t("el-table-column"),K=t("InfoFilled"),ue=t("el-table"),de=t("el-pagination"),Ve=t("el-input"),Pe=t("el-option"),qe=t("el-select"),Ee=u("auth");return d(),r("div",null,[i(C,{"destroy-on-close":"",size:p(H).drawerSize,modelValue:ze.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ze.value=e),"show-close":!0,"before-close":Ie,title:"查看"},{default:n((()=>[i(w,{column:1,border:""},{default:n((()=>[i(a,{label:"规则名称"},{default:n((()=>[s(v(Ne.value.ruleName),1)])),_:1}),i(a,{label:"告警类型"},{default:n((()=>[s(v(Ne.value.alarmType),1)])),_:1}),i(a,{label:"告警级别"},{default:n((()=>[s(v(Ne.value.alarmLevel),1)])),_:1}),i(a,{label:"规则描述"},{default:n((()=>[o("div",P,[o("div",q,null,512)])])),_:1})])),_:1})])),_:1},8,["size","modelValue"]),o("div",E,[i(N,{ref_key:"elSearchFormRef",ref:ve,inline:!0,model:ge.value,class:"demo-form-inline",rules:ne,onKeyup:g(_e,["enter"])},{default:n((()=>[i(j,{label:"创建日期",prop:"CreatedAt"},{label:n((()=>[o("span",null,[l[24]||(l[24]=s(" 创建日期 ")),i(A,{content:"搜索范围是开始日期（包含）至结束日期（不包含）"},{default:n((()=>[i(T,null,{default:n((()=>[i(k)])),_:1})])),_:1})])])),default:n((()=>[i(U,{modelValue:ge.value.startCreatedAt,"onUpdate:modelValue":l[1]||(l[1]=e=>ge.value.startCreatedAt=e),type:"datetime",placeholder:"开始日期","disabled-date":e=>!!ge.value.endCreatedAt&&e.getTime()>ge.value.endCreatedAt.getTime()},null,8,["modelValue","disabled-date"]),l[25]||(l[25]=s(" — ")),i(U,{modelValue:ge.value.endCreatedAt,"onUpdate:modelValue":l[2]||(l[2]=e=>ge.value.endCreatedAt=e),type:"datetime",placeholder:"结束日期","disabled-date":e=>!!ge.value.startCreatedAt&&e.getTime()<ge.value.startCreatedAt.getTime()},null,8,["modelValue","disabled-date"])])),_:1}),J.value?(d(),r(c,{key:0},[],64)):m("",!0),i(j,null,{default:n((()=>[i(x,{type:"primary",icon:"search",onClick:_e},{default:n((()=>l[26]||(l[26]=[s("查询")]))),_:1}),i(x,{icon:"refresh",onClick:ye},{default:n((()=>l[27]||(l[27]=[s("重置")]))),_:1}),J.value?(d(),b(x,{key:1,link:"",type:"primary",icon:"arrow-up",onClick:l[4]||(l[4]=e=>J.value=!1)},{default:n((()=>l[29]||(l[29]=[s("收起")]))),_:1})):(d(),b(x,{key:0,link:"",type:"primary",icon:"arrow-down",onClick:l[3]||(l[3]=e=>J.value=!0)},{default:n((()=>l[28]||(l[28]=[s("展开")]))),_:1}))])),_:1})])),_:1},8,["model","rules"])]),o("div",L,[o("div",M,[f((d(),b(x,{type:"primary",icon:"plus",onClick:l[5]||(l[5]=e=>(Ae.value="create",void(Ue.value=!0)))},{default:n((()=>l[30]||(l[30]=[s("新增")]))),_:1})),[[Ee,p(O).add]]),f((d(),b(x,{icon:"delete",style:{"margin-left":"10px"},disabled:!Ce.value.length,onClick:Te},{default:n((()=>l[31]||(l[31]=[s("删除")]))),_:1},8,["disabled"])),[[Ee,p(O).batchDelete]])]),i(ue,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:be.value,"row-key":"ID",onSelectionChange:ke},{default:n((()=>[i(I,{type:"selection",width:"55"}),i(I,{sortable:"",align:"left",label:"日期",prop:"CreatedAt",width:"180"},{default:n((e=>[s(v(p(y)(e.row.CreatedAt)),1)])),_:1}),i(I,{align:"left",label:"规则名称",prop:"ruleName",width:"120"}),i(I,{align:"left",label:"告警类型",prop:"alarmType",width:"120"},{default:n((e=>[s(v(p(_)(e.row.alarmType,X.value)),1)])),_:1}),i(I,{align:"left",label:"告警级别",prop:"alarmLevel",width:"120"},{default:n((e=>[s(v(p(_)(e.row.alarmLevel,$.value)),1)])),_:1}),i(I,{label:"规则描述",prop:"ruleDescription",width:"200"},{default:n((e=>l[32]||(l[32]=[s(" [富文本内容] ")]))),_:1}),i(I,{align:"left",label:"状态",prop:"status",width:"120"},{default:n((e=>[s(v(p(_)(e.row.status,Z.value)),1)])),_:1}),i(I,{align:"left",label:"操作",fixed:"right","min-width":p(H).operateMinWith},{default:n((e=>[f((d(),b(x,{type:"primary",link:"",class:"table-button",onClick:l=>Be(e.row)},{default:n((()=>[i(T,{style:{"margin-right":"5px"}},{default:n((()=>[i(K)])),_:1}),l[33]||(l[33]=s("查看"))])),_:2},1032,["onClick"])),[[Ee,p(O).info]]),f((d(),b(x,{type:"primary",link:"",icon:"edit",class:"table-button",onClick:l=>(async e=>{const l=await D({ID:e.ID});Ae.value="update",0===l.code&&(ie.value=l.data,Ue.value=!0)})(e.row)},{default:n((()=>l[34]||(l[34]=[s("编辑")]))),_:2},1032,["onClick"])),[[Ee,p(O).edit]]),f((d(),b(x,{type:"primary",link:"",icon:"delete",onClick:l=>{return a=e.row,void V.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{De(a)}));var a}},{default:n((()=>l[35]||(l[35]=[s("删除")]))),_:2},1032,["onClick"])),[[Ee,p(O).delete]])])),_:1},8,["min-width"])])),_:1},8,["data"]),o("div",S,[i(de,{layout:"total, sizes, prev, pager, next, jumper","current-page":pe.value,"page-size":ce.value,"page-sizes":[10,30,50,100],total:me.value,onCurrentChange:we,onSizeChange:he},null,8,["current-page","page-size","total"])])]),i(C,{"destroy-on-close":"",size:p(H).drawerSize,modelValue:Ue.value,"onUpdate:modelValue":l[21]||(l[21]=e=>Ue.value=e),"show-close":!1,"before-close":je},{header:n((()=>[o("div",F,[o("span",R,v("create"===Ae.value?"新增":"编辑"),1),o("div",null,[i(x,{loading:G.value,type:"primary",onClick:xe},{default:n((()=>l[36]||(l[36]=[s("确 定")]))),_:1},8,["loading"]),i(x,{onClick:je},{default:n((()=>l[37]||(l[37]=[s("取 消")]))),_:1})])])])),default:n((()=>[i(N,{model:ie.value,"label-position":"top",ref_key:"elFormRef",ref:se,rules:oe,"label-width":"80px"},{default:n((()=>[i(j,{label:"规则名称:",prop:"ruleName"},{default:n((()=>[i(Ve,{modelValue:ie.value.ruleName,"onUpdate:modelValue":l[6]||(l[6]=e=>ie.value.ruleName=e),clearable:!0,placeholder:"请输入规则名称"},null,8,["modelValue"])])),_:1}),i(j,{label:"告警类型:",prop:"alarmType"},{default:n((()=>[i(qe,{modelValue:ie.value.alarmType,"onUpdate:modelValue":l[7]||(l[7]=e=>ie.value.alarmType=e),placeholder:"请选择告警类型",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(X.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"告警级别:",prop:"alarmLevel"},{default:n((()=>[i(qe,{modelValue:ie.value.alarmLevel,"onUpdate:modelValue":l[8]||(l[8]=e=>ie.value.alarmLevel=e),placeholder:"请选择告警级别",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h($.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"规则描述:",prop:"ruleDescription"},{default:n((()=>[i(z,{modelValue:ie.value.ruleDescription,"onUpdate:modelValue":l[9]||(l[9]=e=>ie.value.ruleDescription=e)},null,8,["modelValue"])])),_:1}),i(j,{label:"触发方式:",prop:"triggerMode"},{default:n((()=>[i(qe,{modelValue:ie.value.triggerMode,"onUpdate:modelValue":l[10]||(l[10]=e=>ie.value.triggerMode=e),placeholder:"请选择触发方式",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(ee.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"产品:",prop:"product"},{default:n((()=>[i(qe,{modelValue:ie.value.product,"onUpdate:modelValue":l[11]||(l[11]=e=>ie.value.product=e),onChange:l[12]||(l[12]=e=>(async e=>{fe=e})(ie.value.product)),clearable:"",placeholder:"选择产品"},{default:n((()=>[(d(!0),r(c,null,h(te.value,(e=>(d(),b(Pe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"设备:",prop:"equipment"},{default:n((()=>[i(qe,{modelValue:ie.value.equipment,"onUpdate:modelValue":l[13]||(l[13]=e=>ie.value.equipment=e),clearable:"",placeholder:"选择设备"},{default:n((()=>[(d(!0),r(c,null,h(re.value,(e=>(d(),b(Pe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"取值类型:",prop:"valueType"},{default:n((()=>[i(qe,{modelValue:ie.value.valueType,"onUpdate:modelValue":l[14]||(l[14]=e=>ie.value.valueType=e),placeholder:"请选择取值类型",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(le.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"original value"!==ie.value.valueType?(d(),b(j,{key:0,label:"取值周期:",prop:"valuePeriod"},{default:n((()=>[i(qe,{modelValue:ie.value.valuePeriod,"onUpdate:modelValue":l[15]||(l[15]=e=>ie.value.valuePeriod=e),placeholder:"请选择取值周期",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(ae.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):m("",!0),i(j,{label:"判断条件:",prop:"judgingCondition"},{default:n((()=>[i(qe,{modelValue:ie.value.judgingCondition,"onUpdate:modelValue":l[16]||(l[16]=e=>ie.value.judgingCondition=e),placeholder:"请选择判断条件",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(Q.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"取值:",prop:"value"},{default:n((()=>[i(Ve,{modelValue:ie.value.value,"onUpdate:modelValue":l[17]||(l[17]=e=>ie.value.value=e),clearable:!0,placeholder:"请输入取值"},null,8,["modelValue"])])),_:1}),i(j,{label:"静默时间:",prop:"silencePeriod"},{default:n((()=>[i(qe,{modelValue:ie.value.silencePeriod,"onUpdate:modelValue":l[18]||(l[18]=e=>ie.value.silencePeriod=e),placeholder:"请选择静默时间",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(Y.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"通知方式:",prop:"meanNotification"},{default:n((()=>[i(qe,{modelValue:ie.value.meanNotification,"onUpdate:modelValue":l[19]||(l[19]=e=>ie.value.meanNotification=e),placeholder:"请选择状态",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(W.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(j,{label:"状态:",prop:"status"},{default:n((()=>[i(qe,{modelValue:ie.value.status,"onUpdate:modelValue":l[20]||(l[20]=e=>ie.value.status=e),placeholder:"请选择状态",style:{width:"100%"},filterable:"",clearable:!0},{default:n((()=>[(d(!0),r(c,null,h(Z.value,((e,l)=>(d(),b(Pe,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["size","modelValue"]),i(C,{"destroy-on-close":"",size:p(H).drawerSize,modelValue:ze.value,"onUpdate:modelValue":l[23]||(l[23]=e=>ze.value=e),"show-close":!0,"before-close":Ie,title:"查看"},{default:n((()=>[i(w,{column:1,border:""},{default:n((()=>[i(a,{label:"规则名称"},{default:n((()=>[s(v(Ne.value.ruleName),1)])),_:1}),i(a,{label:"告警类型"},{default:n((()=>[s(v(Ne.value.alarmType),1)])),_:1}),i(a,{label:"告警级别"},{default:n((()=>[s(v(Ne.value.alarmLevel),1)])),_:1}),i(a,{label:"规则描述"},{default:n((()=>[i(B,{modelValue:Ne.value.ruleDescription,"onUpdate:modelValue":l[22]||(l[22]=e=>Ne.value.ruleDescription=e)},null,8,["modelValue"])])),_:1}),i(a,{label:"触发方式"},{default:n((()=>[s(v(Ne.value.triggerMode),1)])),_:1}),i(a,{label:"取值类型"},{default:n((()=>[s(v(Ne.value.valueType),1)])),_:1}),i(a,{label:"取值周期"},{default:n((()=>[s(v(Ne.value.valuePeriod),1)])),_:1}),i(a,{label:"判断条件"},{default:n((()=>[s(v(Ne.value.judgingCondition),1)])),_:1}),i(a,{label:"取值"},{default:n((()=>[s(v(Ne.value.value),1)])),_:1}),i(a,{label:"静默时间"},{default:n((()=>[s(v(Ne.value.silencePeriod),1)])),_:1}),i(a,{label:"通知方式"},{default:n((()=>[s(v(Ne.value.meanNotification),1)])),_:1}),i(a,{label:"状态"},{default:n((()=>[s(v(Ne.value.status),1)])),_:1})])),_:1})])),_:1},8,["size","modelValue"])])}}});export{K as default};
