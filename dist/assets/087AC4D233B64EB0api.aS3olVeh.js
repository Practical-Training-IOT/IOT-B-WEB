/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{g as e,a,b as l,d as t,c as i,i as o,e as u,u as s,f as n,h as p,s as d}from"./087AC4D233B64EB0api.CuyqIxAv.js";import{t as r}from"./087AC4D233B64EB0stringFun.BxqK0MAg.js";import{_ as c}from"./087AC4D233B64EB0warningBar.C-L0q6NQ.js";import{_ as m,a as v}from"./087AC4D233B64EB0exportTemplate.BSSOPjh_.js";import{_ as f}from"./087AC4D233B64EB0importExcel.a1oA96zH.js";import{b as h}from"./087AC4D233B64EB0autoCode.CYSiuhbc.js";import{_ as g,M as b,a as w,g as y,N as _,c as A,o as C,b as V,f as k,w as x,F as I,D as B,i as G,h as P,t as E,v as z,I as U,P as D,E as j}from"./087AC4D233B64EB0index.CO5TVuii.js";import"./087AC4D233B64EB0exportTemplate.DgOMzIe3.js";const T={class:"gva-search-box"},S={class:"gva-table-box"},F={class:"gva-btn-list"},q={class:"gva-pagination"},O={class:"flex justify-between items-center"},M={class:"flex justify-between items-center"},N={class:"text-lg"},R=g(Object.assign({name:"Api"},{__name:"api",setup(g){const R=b(),J=e=>{const a=W.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},K=w([]),L=w({path:"",apiGroup:"",method:"",description:""}),W=w([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),$=w(""),H=w({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),Q=w(1),X=w(0),Y=w(10),Z=w([]),ee=w({}),ae=w([]),le=w({}),te=async()=>{const e=await a();if(0===e.code){const a=e.data.groups;ae.value=a.map((e=>({label:e,value:e}))),le.value=e.data.apiGroupMap}},ie=async(e,a)=>{const l=await o({path:e.path,method:e.method,flag:a});if(0===l.code){if(j({type:"success",message:l.msg}),a)return ge.value.newApis=ge.value.newApis.filter((a=>!(a.path===e.path&&a.method===e.method))),void ge.value.ignoreApis.push(e);ge.value.ignoreApis=ge.value.ignoreApis.filter((a=>!(a.path===e.path&&a.method===e.method))),ge.value.newApis.push(e)}},oe=()=>{be.value=!1},ue=w(!1),se=async()=>{if(ge.value.newApis.some((e=>!e.apiGroup||!e.description)))return void j({type:"error",message:"存在API未分组或未填写描述"});ue.value=!0;const e=await u(ge.value);ue.value=!1,0===e.code&&(j({type:"success",message:e.msg}),be.value=!1,me())},ne=()=>{ee.value={},me()},pe=()=>{Q.value=1,me()},de=e=>{Y.value=e,me()},re=e=>{Q.value=e,me()},ce=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),ee.value.orderKey=r(e),ee.value.desc="descending"===a),me()},me=async()=>{const a=await e({page:Q.value,pageSize:Y.value,...ee.value});0===a.code&&(Z.value=a.data.list,X.value=a.data.total,Q.value=a.data.page,Y.value=a.data.pageSize)};me(),te();const ve=e=>{K.value=e},fe=async()=>{D.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=K.value.map((e=>e.ID)),a=await n({ids:e});0===a.code&&(j({type:"success",message:a.msg}),Z.value.length===e.length&&Q.value>1&&Q.value--,me())}))},he=async()=>{D.confirm("确定要刷新缓存吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await p();0===e.code&&j({type:"success",message:e.msg})}))},ge=w({newApis:[],deleteApis:[],ignoreApis:[]}),be=w(!1),we=async()=>{const e=await d();0===e.code&&(e.data.newApis.forEach((e=>{e.apiGroup=le.value[e.path.split("/")[1]]})),ge.value=e.data,be.value=!0)},ye=w(null),_e=w("新增Api"),Ae=w(!1),Ce=e=>{switch(e){case"addApi":_e.value="新增Api";break;case"edit":_e.value="编辑Api"}$.value=e,Ae.value=!0},Ve=()=>{ye.value.resetFields(),L.value={path:"",apiGroup:"",method:"",description:""},Ae.value=!1},ke=async()=>{ye.value.validate((async e=>{if(e)switch($.value){case"addApi":0===(await i(L.value)).code&&j({type:"success",message:"添加成功",showClose:!0}),me(),te(),Ve();break;case"edit":0===(await s(L.value)).code&&j({type:"success",message:"编辑成功",showClose:!0}),me(),Ve();break;default:j({type:"error",message:"未知操作",showClose:!0})}}))},xe=w(!1),Ie=async()=>{xe.value=!0;const e=ge.value.newApis.filter((e=>!e.apiGroup||!e.description)).map((e=>e.path)),a=await h({data:e,command:"apiCompletion"});if(xe.value=!1,0===a.code)try{const e=JSON.parse(a.data);ge.value.newApis.forEach((a=>{const l=e.find((e=>e.path===a.path));l&&(a.apiGroup||(a.apiGroup=l.apiGroup),a.description||(a.description=l.description))}))}catch(l){j({type:"error",message:"AI自动填充失败,请重新生成"})}};return(e,a)=>{const o=y("el-input"),u=y("el-form-item"),s=y("el-option"),n=y("el-select"),p=y("el-button"),d=y("el-form"),r=y("el-table-column"),h=y("el-table"),g=y("el-pagination"),b=y("ai-gva"),w=y("el-icon"),$=y("el-drawer"),le=_("loading");return C(),A("div",null,[V("div",T,[k(d,{ref:"searchForm",inline:!0,model:ee.value},{default:x((()=>[k(u,{label:"路径"},{default:x((()=>[k(o,{modelValue:ee.value.path,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),k(u,{label:"描述"},{default:x((()=>[k(o,{modelValue:ee.value.description,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),k(u,{label:"API分组"},{default:x((()=>[k(n,{modelValue:ee.value.apiGroup,"onUpdate:modelValue":a[2]||(a[2]=e=>ee.value.apiGroup=e),clearable:"",placeholder:"请选择"},{default:x((()=>[(C(!0),A(I,null,B(ae.value,(e=>(C(),G(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(u,{label:"请求"},{default:x((()=>[k(n,{modelValue:ee.value.method,"onUpdate:modelValue":a[3]||(a[3]=e=>ee.value.method=e),clearable:"",placeholder:"请选择"},{default:x((()=>[(C(!0),A(I,null,B(W.value,(e=>(C(),G(s,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(u,null,{default:x((()=>[k(p,{type:"primary",icon:"search",onClick:pe},{default:x((()=>a[11]||(a[11]=[P(" 查询 ")]))),_:1}),k(p,{icon:"refresh",onClick:ne},{default:x((()=>a[12]||(a[12]=[P(" 重置 ")]))),_:1})])),_:1})])),_:1},8,["model"])]),V("div",S,[V("div",F,[k(p,{type:"primary",icon:"plus",onClick:a[4]||(a[4]=e=>Ce("addApi"))},{default:x((()=>a[13]||(a[13]=[P(" 新增 ")]))),_:1}),k(p,{icon:"delete",disabled:!K.value.length,onClick:fe},{default:x((()=>a[14]||(a[14]=[P(" 删除 ")]))),_:1},8,["disabled"]),k(p,{icon:"Refresh",onClick:he},{default:x((()=>a[15]||(a[15]=[P(" 刷新缓存 ")]))),_:1}),k(p,{icon:"Compass",onClick:we},{default:x((()=>a[16]||(a[16]=[P(" 同步API ")]))),_:1}),k(m,{"template-id":"api"}),k(v,{"template-id":"api",limit:9999}),k(f,{"template-id":"api",onOnSuccess:me})]),k(h,{data:Z.value,onSortChange:ce,onSelectionChange:ve},{default:x((()=>[k(r,{type:"selection",width:"55"}),k(r,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),k(r,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),k(r,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),k(r,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),k(r,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:x((e=>[V("div",null,E(e.row.method)+" / "+E(J(e.row.method)),1)])),_:1}),k(r,{align:"left",fixed:"right",label:"操作","min-width":z(R).operateMinWith},{default:x((e=>[k(p,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await l({id:e.ID});L.value=a.data.api,Ce("edit")})(e.row)},{default:x((()=>a[17]||(a[17]=[P(" 编辑 ")]))),_:2},1032,["onClick"]),k(p,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{D.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await t(e)).code&&(j({type:"success",message:"删除成功!"}),1===Z.value.length&&Q.value>1&&Q.value--,me(),te())}))})(e.row)},{default:x((()=>a[18]||(a[18]=[P(" 删除 ")]))),_:2},1032,["onClick"])])),_:1},8,["min-width"])])),_:1},8,["data"]),V("div",q,[k(g,{"current-page":Q.value,"page-size":Y.value,"page-sizes":[10,30,50,100],total:X.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:re,onSizeChange:de},null,8,["current-page","page-size","total"])])]),k($,{modelValue:be.value,"onUpdate:modelValue":a[5]||(a[5]=e=>be.value=e),size:z(R).drawerSize,"before-close":oe,"show-close":!1},{header:x((()=>[V("div",O,[a[21]||(a[21]=V("span",{class:"text-lg"},"同步路由",-1)),V("div",null,[k(p,{loading:xe.value,onClick:oe},{default:x((()=>a[19]||(a[19]=[P(" 取 消 ")]))),_:1},8,["loading"]),k(p,{type:"primary",loading:ue.value||xe.value,onClick:se},{default:x((()=>a[20]||(a[20]=[P(" 确 定 ")]))),_:1},8,["loading"])])])])),default:x((()=>[k(c,{title:"同步API，不输入路由分组将不会被自动同步，如果api不需要参与鉴权，可以按忽略按钮进行忽略。"}),V("h4",null,[a[23]||(a[23]=P(" 新增路由 ")),a[24]||(a[24]=V("span",{class:"text-xs text-gray-500 mx-2 font-normal"},"存在于当前路由中，但是不存在于api表",-1)),k(p,{type:"primary",size:"small",onClick:Ie},{default:x((()=>[k(w,{size:"18"},{default:x((()=>[k(b)])),_:1}),a[22]||(a[22]=P(" 自动填充 "))])),_:1})]),U((C(),G(h,{"element-loading-text":"小淼正在思考...",data:ge.value.newApis},{default:x((()=>[k(r,{align:"left",label:"API路径","min-width":"150",prop:"path"}),k(r,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"},{default:x((({row:e})=>[k(n,{modelValue:e.apiGroup,"onUpdate:modelValue":a=>e.apiGroup=a,placeholder:"请选择或新增","allow-create":"",filterable:"","default-first-option":""},{default:x((()=>[(C(!0),A(I,null,B(ae.value,(e=>(C(),G(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),k(r,{align:"left",label:"API简介","min-width":"150",prop:"description"},{default:x((({row:e})=>[k(o,{modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(r,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:x((e=>[V("div",null,E(e.row.method)+" / "+E(J(e.row.method)),1)])),_:1}),k(r,{label:"操作","min-width":"150",fixed:"right"},{default:x((({row:e})=>[k(p,{icon:"plus",type:"primary",link:"",onClick:a=>(async e=>{if(!e.apiGroup)return void j({type:"error",message:"请先选择API分组"});if(!e.description)return void j({type:"error",message:"请先填写API描述"});0===(await i(e)).code&&(j({type:"success",message:"添加成功",showClose:!0}),ge.value.newApis=ge.value.newApis.filter((a=>!(a.path===e.path&&a.method===e.method)))),me(),te()})(e)},{default:x((()=>a[25]||(a[25]=[P(" 单条新增 ")]))),_:2},1032,["onClick"]),k(p,{icon:"sunrise",type:"primary",link:"",onClick:a=>ie(e,!0)},{default:x((()=>a[26]||(a[26]=[P(" 忽略 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[le,ue.value||xe.value]]),a[28]||(a[28]=V("h4",null,[P(" 已删除路由 "),V("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"已经不存在于当前项目的路由中，确定同步后会自动从apis表删除")],-1)),k(h,{data:ge.value.deleteApis},{default:x((()=>[k(r,{align:"left",label:"API路径","min-width":"150",prop:"path"}),k(r,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"}),k(r,{align:"left",label:"API简介","min-width":"150",prop:"description"}),k(r,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:x((e=>[V("div",null,E(e.row.method)+" / "+E(J(e.row.method)),1)])),_:1})])),_:1},8,["data"]),a[29]||(a[29]=V("h4",null,[P(" 忽略路由 "),V("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"忽略路由不参与api同步，常见为不需要进行鉴权行为的路由")],-1)),k(h,{data:ge.value.ignoreApis},{default:x((()=>[k(r,{align:"left",label:"API路径","min-width":"150",prop:"path"}),k(r,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"}),k(r,{align:"left",label:"API简介","min-width":"150",prop:"description"}),k(r,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:x((e=>[V("div",null,E(e.row.method)+" / "+E(J(e.row.method)),1)])),_:1}),k(r,{label:"操作","min-width":"150",fixed:"right"},{default:x((({row:e})=>[k(p,{icon:"sunny",type:"primary",link:"",onClick:a=>ie(e,!1)},{default:x((()=>a[27]||(a[27]=[P(" 取消忽略 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue","size"]),k($,{modelValue:Ae.value,"onUpdate:modelValue":a[10]||(a[10]=e=>Ae.value=e),size:z(R).drawerSize,"before-close":Ve,"show-close":!1},{header:x((()=>[V("div",M,[V("span",N,E(_e.value),1),V("div",null,[k(p,{onClick:Ve},{default:x((()=>a[30]||(a[30]=[P(" 取 消 ")]))),_:1}),k(p,{type:"primary",onClick:ke},{default:x((()=>a[31]||(a[31]=[P(" 确 定 ")]))),_:1})])])])),default:x((()=>[k(c,{title:"新增API，需要在角色管理内配置权限才可使用"}),k(d,{ref_key:"apiForm",ref:ye,model:L.value,rules:H.value,"label-width":"80px"},{default:x((()=>[k(u,{label:"路径",prop:"path"},{default:x((()=>[k(o,{modelValue:L.value.path,"onUpdate:modelValue":a[6]||(a[6]=e=>L.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),k(u,{label:"请求",prop:"method"},{default:x((()=>[k(n,{modelValue:L.value.method,"onUpdate:modelValue":a[7]||(a[7]=e=>L.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:x((()=>[(C(!0),A(I,null,B(W.value,(e=>(C(),G(s,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(u,{label:"api分组",prop:"apiGroup"},{default:x((()=>[k(n,{modelValue:L.value.apiGroup,"onUpdate:modelValue":a[8]||(a[8]=e=>L.value.apiGroup=e),placeholder:"请选择或新增","allow-create":"",filterable:"","default-first-option":""},{default:x((()=>[(C(!0),A(I,null,B(ae.value,(e=>(C(),G(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(u,{label:"api简介",prop:"description"},{default:x((()=>[k(o,{modelValue:L.value.description,"onUpdate:modelValue":a[9]||(a[9]=e=>L.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","size"])])}}}),[["__scopeId","data-v-626c33ec"]]);export{R as default};
