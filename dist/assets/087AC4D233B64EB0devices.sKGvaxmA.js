/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{a as e,M as a,r as l,g as t,N as u,c as d,o,e as i,b as r,f as n,w as v,d as s,F as p,D as c,i as m,h as _,m as f,I as b,v as g,t as h,R as w,S as y,P as V,E as C}from"./087AC4D233B64EB0index.CO5TVuii.js";import{_ as k}from"./087AC4D233B64EB0resources.1e83Uicw.js";import{g as A,a as D,b as B,c as U,f as x,d as z,u as E,e as I}from"./087AC4D233B64EB0devices.Cp0jXCTS.js";import{_ as j}from"./087AC4D233B64EB0rich-edit.ylmqdvQl.js";import{_ as S}from"./087AC4D233B64EB0rich-view.B-1ov_xT.js";import{u as T}from"./087AC4D233B64EB0btnAuth.C6tLskk0.js";import{_ as N}from"./087AC4D233B64EB0importExcel.a1oA96zH.js";import"./087AC4D233B64EB0image.DZXThNBc.js";const M={class:"gva-search-box"},F={class:"gva-table-box"},G={class:"gva-btn-list"},R={class:"gva-pagination"},q={class:"flex justify-between items-center"},O={class:"text-lg"},K={key:0},P={key:1},J=Object.assign({name:"Devices"},{__name:"devices",setup(J){const W=T(),H=e(!1),L=a(),Q=e(!1),X=e([]),Y=e([]),Z=e([]),$=e([]),ee=e([]),ae=e({product_range:"",platform:"",drive:"",status:"",add_device_method:"1",drive_name:"",belonging_products:"",association_driven:"",device_description:"",productName:"",name:"",driver_name:""}),le=l({add_device_method:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],drive_name:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],belonging_products:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}]}),te=l({CreatedAt:[{validator:(e,a,l)=>{ve.value.startCreatedAt&&!ve.value.endCreatedAt?l(new Error("请填写结束日期")):!ve.value.startCreatedAt&&ve.value.endCreatedAt?l(new Error("请填写开始日期")):ve.value.startCreatedAt&&ve.value.endCreatedAt&&(ve.value.startCreatedAt.getTime()===ve.value.endCreatedAt.getTime()||ve.value.startCreatedAt.getTime()>ve.value.endCreatedAt.getTime())?l(new Error("开始日期应当早于结束日期")):l()},trigger:"change"}]}),ue=e(),de=e(),oe=e(1),ie=e(0),re=e(10),ne=e([]),ve=e({}),se=()=>{ve.value={},_e()},pe=()=>{var e;null==(e=de.value)||e.validate((async e=>{e&&(oe.value=1,_e())}))},ce=e=>{re.value=e,_e()},me=e=>{oe.value=e,_e()},_e=async()=>{const e=await A({page:oe.value,pageSize:re.value,...ve.value});0===e.code&&(ne.value=e.data.list,ie.value=e.data.total,oe.value=e.data.page,re.value=e.data.pageSize)},fe=e([]),be=e([]),ge=e([]),he=e([]),we=e([]),ye=e([]);_e(),(async()=>{const e=await D();if(0===e.code){const a=e.data;fe.value=a.map((e=>({label:e.productName,value:e.productName}))),be.value=e.data.productGroupMap}})(),(async()=>{const e=await B();if(0===e.code){const a=e.data;ge.value=a.map((e=>({label:e.name,value:e.name}))),he.value=e.data.productGroupTwoMap}})(),(async()=>{const e=await U();if(0===e.code){const a=e.data;we.value=a.map((e=>({label:e.driver_name,value:e.driver_name}))),ye.value=e.data.driverGroupMap}})();(async()=>{X.value=await y("addDeviceMethod"),Y.value=await y("platformType"),Z.value=await y("driveStatus"),$.value=await y("productRange"),ee.value=await y("drive")})();const Ve=e([]),Ce=e=>{Ve.value=e},ke=e(""),Ae=async e=>{0===(await I({ID:e.ID})).code&&(C({type:"success",message:"删除成功"}),1===ne.value.length&&oe.value>1&&oe.value--,_e())},De=e(!1),Be=()=>{De.value=!1,ae.value={product_range:"",platform:"",drive:"",status:"",add_device_method:"1",drive_name:"",belonging_products:"",association_driven:"",device_description:"",productName:"",name:"",driver_name:""}},Ue=async()=>{var e;H.value=!0,null==(e=ue.value)||e.validate((async e=>{if(!e)return H.value=!1;let a;switch(ke.value){case"create":default:a=await z(ae.value);break;case"update":a=await E(ae.value)}H.value=!1,0===a.code&&(C({type:"success",message:"创建/更改成功"}),Be(),_e())}))},xe=e({}),ze=e(!1),Ee=async e=>{const a=await x({ID:e.ID});0===a.code&&(xe.value=a.data,ze.value=!0)},Ie=()=>{ze.value=!1,xe.value={}};return(e,a)=>{const l=t("el-option"),y=t("el-select"),C=t("el-form-item"),A=t("el-input"),D=t("el-button"),B=t("el-form"),U=t("el-table-column"),z=t("InfoFilled"),E=t("el-icon"),I=t("el-table"),T=t("el-pagination"),J=t("el-radio"),$=t("el-radio-group"),be=t("el-drawer"),he=t("el-descriptions-item"),ye=t("el-descriptions"),Ve=u("auth");return o(),d(p,null,[a[32]||(a[32]=i('<div class="page-header"><div class="page-header-content"><div class="page-header-title"><h2>设备管理</h2><p>物理设备要连接到平台，需要先在平台创建设备(支持单个或批量导入创建)。设备列表包含自主创建的设备和云平台同步的设备，同时支持灵活的搜索。</p></div><div class="page-header-image"><img src="'+k+'" alt="资源管理背景图"></div></div></div>',1)),r("div",null,[r("div",M,[n(B,{ref_key:"elSearchFormRef",ref:de,inline:!0,model:ve.value,class:"demo-form-inline",rules:te,onKeyup:f(pe,["enter"])},{default:v((()=>[n(C,{label:"",prop:"productName"},{default:v((()=>[n(y,{modelValue:ve.value.product_name,"onUpdate:modelValue":a[0]||(a[0]=e=>ve.value.product_name=e),clearable:"",placeholder:"产品范围（全部）"},{default:v((()=>[(o(!0),d(p,null,c(fe.value,(e=>(o(),m(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"",prop:"platform"},{default:v((()=>[n(y,{modelValue:ve.value.platform,"onUpdate:modelValue":a[1]||(a[1]=e=>ve.value.platform=e),clearable:"",filterable:"",placeholder:"平台（全部）",onClear:a[2]||(a[2]=()=>{ve.value.platform=void 0})},{default:v((()=>[(o(!0),d(p,null,c(Y.value,((e,a)=>(o(),m(l,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"",prop:"drive"},{default:v((()=>[n(y,{modelValue:ve.value.drive,"onUpdate:modelValue":a[3]||(a[3]=e=>ve.value.drive=e),clearable:"",filterable:"",placeholder:"驱动（全部）",onClear:a[4]||(a[4]=()=>{ve.value.drive=void 0})},{default:v((()=>[(o(!0),d(p,null,c(ee.value,((e,a)=>(o(),m(l,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"",prop:"status"},{default:v((()=>[n(y,{modelValue:ve.value.status,"onUpdate:modelValue":a[5]||(a[5]=e=>ve.value.status=e),clearable:"",filterable:"",placeholder:"状态（全部）",onClear:a[6]||(a[6]=()=>{ve.value.status=void 0})},{default:v((()=>[(o(!0),d(p,null,c(Z.value,((e,a)=>(o(),m(l,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"",prop:"drive_name"},{default:v((()=>[n(A,{modelValue:ve.value.drive_name,"onUpdate:modelValue":a[7]||(a[7]=e=>ve.value.drive_name=e),placeholder:"设备名称"},null,8,["modelValue"])])),_:1}),Q.value?(o(),d(p,{key:0},[],64)):s("",!0),n(C,null,{default:v((()=>[n(D,{type:"primary",icon:"search",onClick:pe},{default:v((()=>a[21]||(a[21]=[_("查询")]))),_:1}),n(D,{icon:"refresh",onClick:se},{default:v((()=>a[22]||(a[22]=[_("重置")]))),_:1}),Q.value?(o(),m(D,{key:1,link:"",type:"primary",icon:"arrow-up",onClick:a[9]||(a[9]=e=>Q.value=!1)},{default:v((()=>a[24]||(a[24]=[_("收起")]))),_:1})):(o(),m(D,{key:0,link:"",type:"primary",icon:"arrow-down",onClick:a[8]||(a[8]=e=>Q.value=!0)},{default:v((()=>a[23]||(a[23]=[_("展开")]))),_:1}))])),_:1})])),_:1},8,["model","rules"])]),r("div",F,[r("div",G,[b((o(),m(D,{type:"primary",icon:"plus",onClick:a[10]||(a[10]=e=>(ke.value="create",void(De.value=!0)))},{default:v((()=>a[25]||(a[25]=[_("新增")]))),_:1})),[[Ve,g(W).add]])]),n(I,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:ne.value,"row-key":"ID",onSelectionChange:Ce},{default:v((()=>[n(U,{type:"selection",width:"55"}),n(U,{align:"left",label:"设备ID",prop:"ID",width:"120"}),n(U,{align:"left",label:"平台",prop:"platform",width:"150"},{default:v((e=>[_(h(g(w)(e.row.platform,Y.value)),1)])),_:1}),n(U,{align:"left",label:"状态",prop:"status",width:"120"},{default:v((e=>[_(h(g(w)(e.row.status,Z.value)),1)])),_:1}),n(U,{align:"left",label:"设备添加方式",prop:"add_device_method",width:"120"},{default:v((e=>[_(h(g(w)(e.row.add_device_method,X.value)),1)])),_:1}),n(U,{align:"left",label:"设备名称",prop:"drive_name",width:"120"}),n(U,{align:"left",label:"所属产品",prop:"belonging_products",width:"120"}),n(U,{align:"left",label:"关联驱动",prop:"association_driven",width:"120"}),n(U,{align:"left",label:"操作",fixed:"right","min-width":g(L).operateMinWith},{default:v((e=>[b((o(),m(D,{type:"primary",link:"",class:"table-button",onClick:a=>Ee(e.row)},{default:v((()=>[n(E,{style:{"margin-right":"5px"}},{default:v((()=>[n(z)])),_:1}),a[26]||(a[26]=_("查看"))])),_:2},1032,["onClick"])),[[Ve,g(W).info]]),b((o(),m(D,{type:"primary",link:"",icon:"edit",class:"table-button",onClick:a=>(async e=>{const a=await x({ID:e.ID});ke.value="update",0===a.code&&(ae.value=a.data,De.value=!0)})(e.row)},{default:v((()=>a[27]||(a[27]=[_("编辑")]))),_:2},1032,["onClick"])),[[Ve,g(W).edit]]),b((o(),m(D,{type:"primary",link:"",icon:"delete",onClick:a=>{return l=e.row,void V.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{Ae(l)}));var l}},{default:v((()=>a[28]||(a[28]=[_("删除")]))),_:2},1032,["onClick"])),[[Ve,g(W).delete]])])),_:1},8,["min-width"])])),_:1},8,["data"]),r("div",R,[n(T,{layout:"total, sizes, prev, pager, next, jumper","current-page":oe.value,"page-size":re.value,"page-sizes":[10,30,50,100],total:ie.value,onCurrentChange:me,onSizeChange:ce},null,8,["current-page","page-size","total"])])]),n(be,{"destroy-on-close":"",size:g(L).drawerSize,modelValue:De.value,"onUpdate:modelValue":a[18]||(a[18]=e=>De.value=e),"show-close":!1,"before-close":Be},{header:v((()=>[r("div",q,[r("span",O,h("create"===ke.value?"新增":"编辑"),1),r("div",null,[n(D,{loading:H.value,type:"primary",onClick:Ue},{default:v((()=>a[29]||(a[29]=[_("确 定")]))),_:1},8,["loading"]),n(D,{onClick:Be},{default:v((()=>a[30]||(a[30]=[_("取 消")]))),_:1})])])])),default:v((()=>[n(B,{model:ae.value,"label-position":"top",ref_key:"elFormRef",ref:ue,rules:le,"label-width":"80px"},{default:v((()=>[n(C,{label:"设备添加方式:",prop:"add_device_method"},{default:v((()=>[n($,{modelValue:ae.value.add_device_method,"onUpdate:modelValue":a[11]||(a[11]=e=>ae.value.add_device_method=e),style:{width:"100%"}},{default:v((()=>[(o(!0),d(p,null,c(X.value,((e,a)=>(o(),m(J,{key:a,label:e.value},{default:v((()=>[_(h(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),"1"===ae.value.add_device_method?(o(),d("div",K,[n(C,{label:"设备名称:",prop:"drive_name"},{default:v((()=>[n(A,{modelValue:ae.value.drive_name,"onUpdate:modelValue":a[12]||(a[12]=e=>ae.value.drive_name=e),clearable:!0,placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),n(C,{label:"所属产品",prop:"belonging_products"},{default:v((()=>[n(y,{modelValue:ae.value.belonging_products,"onUpdate:modelValue":a[13]||(a[13]=e=>ae.value.belonging_products=e),placeholder:"请输入所属产品","allow-create":"",filterable:"","default-first-option":""},{default:v((()=>[(o(!0),d(p,null,c(ge.value,(e=>(o(),m(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"关联驱动",prop:"driver_name"},{default:v((()=>[n(y,{modelValue:ae.value.association_driven,"onUpdate:modelValue":a[14]||(a[14]=e=>ae.value.association_driven=e),placeholder:"请输入关联驱动","allow-create":"",filterable:"","default-first-option":""},{default:v((()=>[(o(!0),d(p,null,c(we.value,(e=>(o(),m(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"设备描述:",prop:"device_description"},{default:v((()=>[n(j,{modelValue:ae.value.device_description,"onUpdate:modelValue":a[15]||(a[15]=e=>ae.value.device_description=e)},null,8,["modelValue"])])),_:1})])):s("",!0),"2"===ae.value.add_device_method?(o(),d("div",P,[n(C,{label:"上传设备表:"},{default:v((()=>[n(N,{"template-id":"api",onOnSuccess:_e})])),_:1}),a[31]||(a[31]=r("div",{style:{height:"20px"}},null,-1)),n(C,{label:"所属产品",prop:"belonging_products"},{default:v((()=>[n(y,{modelValue:ae.value.belonging_products,"onUpdate:modelValue":a[16]||(a[16]=e=>ae.value.belonging_products=e),placeholder:"请输入所属产品","allow-create":"",filterable:"","default-first-option":""},{default:v((()=>[(o(!0),d(p,null,c(ge.value,(e=>(o(),m(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"关联驱动",prop:"driver_name"},{default:v((()=>[n(y,{modelValue:ae.value.association_driven,"onUpdate:modelValue":a[17]||(a[17]=e=>ae.value.association_driven=e),placeholder:"请输入关联驱动","allow-create":"",filterable:"","default-first-option":""},{default:v((()=>[(o(!0),d(p,null,c(we.value,(e=>(o(),m(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])):s("",!0)])),_:1},8,["model","rules"])])),_:1},8,["size","modelValue"]),n(be,{"destroy-on-close":"",size:g(L).drawerSize,modelValue:ze.value,"onUpdate:modelValue":a[20]||(a[20]=e=>ze.value=e),"show-close":!0,"before-close":Ie,title:"查看"},{default:v((()=>[n(ye,{column:1,border:""},{default:v((()=>[n(he,{label:"平台"},{default:v((()=>[_(h(xe.value.platform),1)])),_:1}),n(he,{label:"驱动"},{default:v((()=>[_(h(xe.value.drive),1)])),_:1}),n(he,{label:"状态"},{default:v((()=>[_(h(xe.value.status),1)])),_:1}),n(he,{label:"设备添加方式"},{default:v((()=>[_(h(xe.value.add_device_method),1)])),_:1}),n(he,{label:"设备名称"},{default:v((()=>[_(h(xe.value.drive_name),1)])),_:1}),n(he,{label:"所属产品"},{default:v((()=>[_(h(xe.value.belonging_products),1)])),_:1}),n(he,{label:"关联驱动"},{default:v((()=>[_(h(xe.value.association_driven),1)])),_:1}),n(he,{label:"设备描述"},{default:v((()=>[n(S,{modelValue:xe.value.device_description,"onUpdate:modelValue":a[19]||(a[19]=e=>xe.value.device_description=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["size","modelValue"])])],64)}}});export{J as default};
