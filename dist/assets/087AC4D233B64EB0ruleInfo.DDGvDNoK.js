/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{_ as e,a as l,M as a,r as t,g as u,N as o,c as d,o as r,b as s,f as n,e as i,w as c,d as v,F as p,D as m,i as f,h as b,m as g,I as h,v as y,t as _,O as w,S as C,E as V,P as E}from"./087AC4D233B64EB0index.CO5TVuii.js";import{_ as k}from"./087AC4D233B64EB0resources.1e83Uicw.js";import{g as D,h as A,f as I,c as S,u as T,d as x,a as B}from"./087AC4D233B64EB0ruleInfo.Di9mw18s.js";import{u as M}from"./087AC4D233B64EB0btnAuth.C6tLskk0.js";import{_ as N,a as U}from"./087AC4D233B64EB0exportTemplate.BSSOPjh_.js";import{_ as z}from"./087AC4D233B64EB0importExcel.a1oA96zH.js";import{e as F}from"./087AC4D233B64EB0resources.Bfh7D7RJ.js";import"./087AC4D233B64EB0exportTemplate.DgOMzIe3.js";const j={class:"gva-search-box"},R={class:"gva-table-box"},q={class:"gva-btn-list"},O={class:"gva-pagination"},P={class:"glass-container"},H={class:"drawer-header"},K={class:"drawer-span"},L={key:0,class:"condition-section"},Q={key:1,class:"forward-method-section"},W={class:"module"},G={class:"module"},Z={class:"module"},$=e(Object.assign({name:"RuleInfo"},{__name:"ruleInfo",setup(e){const $=M(),J=l(!1),X=a(),Y=l(!1),ee=l([]),le=l({ruleName:"",ruleDescription:"",isEnabled:!0,messageSource:"",queryFields:"*",conditions:"",sqlStatement:"",forwardMethod:"",resource:""}),ae=t({}),te=t({CreatedAt:[{validator:(e,l,a)=>{ie.value.startCreatedAt&&!ie.value.endCreatedAt?a(new Error("请填写结束日期")):!ie.value.startCreatedAt&&ie.value.endCreatedAt?a(new Error("请填写开始日期")):ie.value.startCreatedAt&&ie.value.endCreatedAt&&(ie.value.startCreatedAt.getTime()===ie.value.endCreatedAt.getTime()||ie.value.startCreatedAt.getTime()>ie.value.endCreatedAt.getTime())?a(new Error("开始日期应当早于结束日期")):a()},trigger:"change"}]}),ue=l(),oe=l(),de=l(1),re=l(0),se=l(10),ne=l([]),ie=l({}),ce=()=>{ie.value={},fe()},ve=()=>{var e;null==(e=oe.value)||e.validate((async e=>{e&&(de.value=1,""===ie.value.isEnabled&&(ie.value.isEnabled=null),fe())}))},pe=e=>{se.value=e,fe()},me=e=>{de.value=e,fe()},fe=async()=>{const e=await D({page:de.value,pageSize:se.value,...ie.value});0===e.code&&(ne.value=e.data.list,re.value=e.data.total,de.value=e.data.page,se.value=e.data.pageSize)};fe();(async()=>{ee.value=await C("MessageSource")})();const be=l([]),ge=e=>{be.value=e},he=async()=>{E.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=[];if(0===be.value.length)return void V({type:"warning",message:"请选择要删除的数据"});be.value&&be.value.map((l=>{e.push(l.ID)}));0===(await B({IDs:e})).code&&(V({type:"success",message:"删除成功"}),ne.value.length===e.length&&de.value>1&&de.value--,fe())}))},ye=l(""),_e=l(!1),we=l(!1),Ce=()=>{""!==le.value.ruleName?_e.value=!0:""===le.value.ruleName&&(_e.value=!1)},Ve=()=>{""!==le.value.messageSource?we.value=!0:""===le.value.messageSource&&(we.value=!1)},Ee=async e=>{0===(await x({ID:e.ID})).code&&(V({type:"success",message:"删除成功"}),1===ne.value.length&&de.value>1&&de.value--,fe())},ke=l(!1),De=()=>{ke.value=!1,le.value={ruleName:"",ruleDescription:"",isEnabled:!0,messageSource:"",queryFields:"*",conditions:"",sqlStatement:"",forwardMethod:"",resource:""}},Ae=async()=>{var e;J.value=!0,null==(e=ue.value)||e.validate((async e=>{if(!e)return J.value=!1;let l;switch(ye.value){case"create":default:l=await S(le.value);break;case"update":l=await T(le.value)}J.value=!1,0===l.code&&(V({type:"success",message:"创建/更改成功"}),De(),fe())}))},Ie=l([]),Se=l({}),Te=l([{value:!0,label:"是"},{value:!1,label:"否"},{value:void 0,label:"全部显示"}]),xe=async()=>{(async()=>{const e=await F({name:le.value.forwardMethod});if(0===e.code){const l=e.data;Ie.value=l.map((e=>({label:e.name,value:e.ID}))),Se.value=e.data.apiGroupMap}})()},Be=l({}),Me=l(!1),Ne=async e=>{const l=await I({ID:e.ID});0===l.code&&(Be.value=l.data,Me.value=!0)},Ue=()=>{Me.value=!1,Be.value={}};return(e,l)=>{const a=u("el-option"),t=u("el-select"),C=u("el-form-item"),D=u("el-input"),S=u("el-button"),T=u("el-form"),x=u("el-table-column"),B=u("el-switch"),M=u("InfoFilled"),F=u("el-icon"),Se=u("el-table"),ze=u("el-pagination"),Fe=u("el-alert"),je=u("el-radio"),Re=u("el-radio-group"),qe=u("router-link"),Oe=u("el-drawer"),Pe=u("el-descriptions-item"),He=u("el-descriptions"),Ke=o("auth");return r(),d("div",null,[s("div",j,[l[19]||(l[19]=i('<div class="page-header" data-v-fd4c2fde><div class="page-header-content" data-v-fd4c2fde><div class="page-header-title" data-v-fd4c2fde><h1 data-v-fd4c2fde>规则引擎</h1><p data-v-fd4c2fde>规则引擎提供数据流转能力，可对接入平台的设备数据进行过滤转换，并将数据推送至用户指定的消息目的地。规则引擎流转规则需要配置消息源（推送消息类型）、条件过滤规则及消息目的地（推送方式）。</p></div><div class="page-header-image" data-v-fd4c2fde><img src="'+k+'" alt="资源管理背景图" data-v-fd4c2fde></div></div></div>',1)),n(T,{ref_key:"elSearchFormRef",ref:oe,inline:!0,model:ie.value,class:"demo-form-inline",rules:te,onKeyup:g(ve,["enter"])},{default:c((()=>[n(C,{label:"是否开启"},{default:c((()=>[n(t,{modelValue:ie.value.isEnabled,"onUpdate:modelValue":l[0]||(l[0]=e=>ie.value.isEnabled=e),clearable:"",placeholder:"请选择"},{default:c((()=>[(r(!0),d(p,null,m(Te.value,(e=>(r(),f(a,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"规则名称",prop:"ruleName"},{default:c((()=>[n(D,{modelValue:ie.value.ruleName,"onUpdate:modelValue":l[1]||(l[1]=e=>ie.value.ruleName=e),placeholder:"搜索条件"},null,8,["modelValue"])])),_:1}),Y.value?(r(),d(p,{key:0},[],64)):v("",!0),n(C,null,{default:c((()=>[n(S,{type:"primary",icon:"search",onClick:ve},{default:c((()=>l[15]||(l[15]=[b("查询")]))),_:1}),n(S,{icon:"refresh",onClick:ce},{default:c((()=>l[16]||(l[16]=[b("重置")]))),_:1}),Y.value?(r(),f(S,{key:1,link:"",type:"primary",icon:"arrow-up",onClick:l[3]||(l[3]=e=>Y.value=!1)},{default:c((()=>l[18]||(l[18]=[b("收起")]))),_:1})):(r(),f(S,{key:0,link:"",type:"primary",icon:"arrow-down",onClick:l[2]||(l[2]=e=>Y.value=!0)},{default:c((()=>l[17]||(l[17]=[b("展开")]))),_:1}))])),_:1})])),_:1},8,["model","rules"])]),s("div",R,[s("div",q,[h((r(),f(S,{type:"primary",icon:"plus",onClick:l[4]||(l[4]=e=>(ye.value="create",void(ke.value=!0)))},{default:c((()=>l[20]||(l[20]=[b("新增")]))),_:1})),[[Ke,y($).add]]),h((r(),f(S,{icon:"delete",style:{"margin-left":"10px"},disabled:!be.value.length,onClick:he},{default:c((()=>l[21]||(l[21]=[b("删除")]))),_:1},8,["disabled"])),[[Ke,y($).batchDelete]]),h(n(N,{"template-id":"rules_RuleInfo"},null,512),[[Ke,y($).exportTemplate]]),h(n(U,{"template-id":"rules_RuleInfo",filterDeleted:""},null,512),[[Ke,y($).exportExcel]]),h(n(z,{"template-id":"rules_RuleInfo",onOnSuccess:fe},null,512),[[Ke,y($).importExcel]])]),n(Se,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:ne.value,"row-key":"ID",onSelectionChange:ge},{default:c((()=>[n(x,{type:"selection",width:"55"}),n(x,{align:"left",label:"规则名称",prop:"ruleName",width:"120"}),n(x,{align:"left",label:"规则描述",prop:"ruleDescription",width:"120"}),n(x,{align:"left",label:"转发方式",prop:"forwardMethod",width:"120"}),n(x,{sortable:"",align:"left",label:"日期",prop:"CreatedAt",width:"180"},{default:c((e=>[b(_(y(w)(e.row.CreatedAt)),1)])),_:1}),n(x,{align:"left",label:"是否显示",prop:"isEnabled",width:"120"},{default:c((e=>[n(B,{modelValue:e.row.isEnabled,"onUpdate:modelValue":l=>e.row.isEnabled=l,"active-color":"#13ce66","inactive-color":"#ff4949",onChange:l=>(async e=>{0===(await A({status:e.isEnabled,id:e.ID})).code&&(V({type:"success",message:"修改成功"}),1===ne.value.length&&de.value>1&&de.value--,fe())})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),n(x,{align:"left",label:"操作",fixed:"right","min-width":y(X).operateMinWith},{default:c((e=>[h((r(),f(S,{type:"primary",link:"",class:"table-button",onClick:l=>Ne(e.row)},{default:c((()=>[n(F,{style:{"margin-right":"5px"}},{default:c((()=>[n(M)])),_:1}),l[22]||(l[22]=b("查看"))])),_:2},1032,["onClick"])),[[Ke,y($).info]]),h((r(),f(S,{type:"primary",link:"",icon:"edit",class:"table-button",onClick:l=>(async e=>{const l=await I({ID:e.ID});ye.value="update",0===l.code&&(le.value=l.data,ke.value=!0)})(e.row)},{default:c((()=>l[23]||(l[23]=[b("编辑")]))),_:2},1032,["onClick"])),[[Ke,y($).edit]]),h((r(),f(S,{type:"primary",link:"",icon:"delete",onClick:l=>{return a=e.row,void E.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{Ee(a)}));var a}},{default:c((()=>l[24]||(l[24]=[b("删除")]))),_:2},1032,["onClick"])),[[Ke,y($).delete]])])),_:1},8,["min-width"])])),_:1},8,["data"]),s("div",O,[n(ze,{layout:"total, sizes, prev, pager, next, jumper","current-page":de.value,"page-size":se.value,"page-sizes":[10,30,50,100],total:re.value,onCurrentChange:me,onSizeChange:pe},null,8,["current-page","page-size","total"])])]),n(Oe,{"destroy-on-close":"",size:y(X).drawerSize,modelValue:ke.value,"onUpdate:modelValue":l[13]||(l[13]=e=>ke.value=e),"show-close":!1,"before-close":De,class:"glass-drawer"},{default:c((()=>[s("div",P,[s("div",H,[s("span",K,_("create"===ye.value?"新增规则":"编辑规则"),1),s("div",null,[n(S,{loading:J.value,type:"primary",onClick:Ae},{default:c((()=>l[25]||(l[25]=[b("确 定")]))),_:1},8,["loading"]),n(S,{onClick:De},{default:c((()=>l[26]||(l[26]=[b("取 消")]))),_:1})])]),n(T,{ref_key:"elFormRef",ref:ue,model:le.value,rules:ae,"label-position":"top","label-width":"80px",class:"form-content"},{default:c((()=>[n(C,{label:"规则名称:",prop:"ruleName"},{default:c((()=>[n(D,{modelValue:le.value.ruleName,"onUpdate:modelValue":l[5]||(l[5]=e=>le.value.ruleName=e),clearable:"",placeholder:"请输入规则名称",onChange:Ce},null,8,["modelValue"])])),_:1}),n(C,{label:"规则描述:",prop:"ruleDescription"},{default:c((()=>[n(D,{modelValue:le.value.ruleDescription,"onUpdate:modelValue":l[6]||(l[6]=e=>le.value.ruleDescription=e),clearable:"",placeholder:"请输入规则描述"},null,8,["modelValue"])])),_:1}),n(C,{label:"启用状态:",prop:"isEnabled"},{default:c((()=>[n(B,{modelValue:le.value.isEnabled,"onUpdate:modelValue":l[7]||(l[7]=e=>le.value.isEnabled=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])])),_:1}),_e.value||"update"===ye.value?(r(),d("section",L,[l[28]||(l[28]=s("h3",null,"条件过滤",-1)),l[29]||(l[29]=s("p",null,"(SELECT [查询字段] FROM [消息源] WHERE [条件])，多个筛选项之间取交集",-1)),n(Fe,{title:"重要提示：修改消息源和查询字段可能会导致输出的数据格式有变化",type:"warning"}),n(C,{label:"消息总线:",prop:"httpMethod"},{default:c((()=>[n(t,{modelValue:le.value.messageSource,"onUpdate:modelValue":l[8]||(l[8]=e=>le.value.messageSource=e),placeholder:"请选择消息总线",onChange:Ve,style:{width:"100%"},filterable:"",clearable:""},{default:c((()=>[(r(!0),d(p,null,m(ee.value,((e,l)=>(r(),f(a,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"查询字段:",prop:"queryFields"},{default:c((()=>[n(D,{modelValue:le.value.queryFields,"onUpdate:modelValue":l[9]||(l[9]=e=>le.value.queryFields=e),placeholder:"请输入查询字段"},null,8,["modelValue"])])),_:1}),n(C,{label:"条件:",prop:"conditions"},{default:c((()=>[n(D,{modelValue:le.value.conditions,"onUpdate:modelValue":l[10]||(l[10]=e=>le.value.conditions=e),placeholder:"请输入条件"},null,8,["modelValue"])])),_:1}),s("p",null,[l[27]||(l[27]=b("SQL语句展示:")),s("b",null,"SELECT "+_(le.value.queryFields)+" FROM "+_(le.value.messageSource)+" WHERE "+_(le.value.conditions),1)])])):v("",!0),we.value||"update"===ye.value?(r(),d("section",Q,[l[36]||(l[36]=s("h3",null,"转发方式",-1)),n(Re,{modelValue:le.value.forwardMethod,"onUpdate:modelValue":l[11]||(l[11]=e=>le.value.forwardMethod=e),class:"radio-group",onChange:xe},{default:c((()=>[n(je,{label:"HTTP"},{default:c((()=>l[30]||(l[30]=[b("HTTP推送")]))),_:1}),n(je,{label:"MQTT"},{default:c((()=>l[31]||(l[31]=[b("消息队列MQTT")]))),_:1}),n(je,{label:"Kafka"},{default:c((()=>l[32]||(l[32]=[b("消息队列Kafka")]))),_:1})])),_:1},8,["modelValue"]),n(C,{label:"API分组"},{default:c((()=>[n(t,{modelValue:le.value.resource,"onUpdate:modelValue":l[12]||(l[12]=e=>le.value.resource=e),clearable:"",placeholder:"请选择"},{default:c((()=>[(r(!0),d(p,null,m(Ie.value,(e=>(r(),f(a,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s("span",null,[l[34]||(l[34]=b("您可前往")),n(qe,{to:"/layout/seniorManagement/resources"},{default:c((()=>l[33]||(l[33]=[s("b",null,"资源管理",-1)]))),_:1}),l[35]||(l[35]=b("，添加您的资源"))])])):v("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["size","modelValue"]),n(Oe,{"destroy-on-close":"",size:y(X).drawerSize,modelValue:Me.value,"onUpdate:modelValue":l[14]||(l[14]=e=>Me.value=e),"show-close":!0,"before-close":Ue,title:"查看"},{default:c((()=>[s("div",W,[l[37]||(l[37]=s("h3",null,"基础信息",-1)),n(He,{column:1,border:""},{default:c((()=>[n(Pe,{label:"规则ID"},{default:c((()=>[b(_(Be.value.ID),1)])),_:1}),n(Pe,{label:"规则名称"},{default:c((()=>[b(_(Be.value.ruleName),1)])),_:1}),n(Pe,{label:"规则描述"},{default:c((()=>[b(_(Be.value.ruleDescription),1)])),_:1}),n(Pe,{label:"启用状态"},{default:c((()=>[b(_(Be.value.isEnabled?"启用":"停用"),1)])),_:1})])),_:1})]),s("div",G,[l[38]||(l[38]=s("h3",null,"条件过滤",-1)),n(He,{column:1,border:""},{default:c((()=>[n(Pe,{label:"消息源"},{default:c((()=>[b(_(Be.value.messageSource),1)])),_:1}),n(Pe,{label:"查询字段"},{default:c((()=>[b(_(Be.value.queryFields),1)])),_:1}),n(Pe,{label:"条件"},{default:c((()=>[b(_(Be.value.conditions),1)])),_:1})])),_:1})]),s("div",Z,[l[39]||(l[39]=s("h3",null,"转发方式",-1)),n(He,{column:1,border:""},{default:c((()=>[n(Pe,{label:"转发方式"},{default:c((()=>[b(_(Be.value.forwardMethod),1)])),_:1}),n(Pe,{label:"使用资源"},{default:c((()=>[b(_(Be.value.resource),1)])),_:1})])),_:1})])])),_:1},8,["size","modelValue"])])}}}),[["__scopeId","data-v-fd4c2fde"]]);export{$ as default};
