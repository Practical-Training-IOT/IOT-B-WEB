/*! 
 Build based on gin-vue-admin 
 Time : 1746843967000 */
import{_ as e,C as a,a as l,U as t,g as s,b as n,d as o,e as i,c as u,f as d,i as r}from"./087AC4D233B64EB0QR-code.C8XZhORv.js";import{C as c}from"./087AC4D233B64EB0index.CgfTQ-_v.js";import{a as p,g as m,N as v,I as g,c as f,o as w,b as h,f as y,w as I,n as k,t as x,i as b,d as C,h as _,v as D,O as B,E,P as V,am as O}from"./087AC4D233B64EB0index.CO5TVuii.js";import{_ as j}from"./087AC4D233B64EB0warningBar.C-L0q6NQ.js";import"./087AC4D233B64EB0image.DZXThNBc.js";import"./087AC4D233B64EB0vue-cropper.es.nUnGqwbp.js";import"./087AC4D233B64EB0logo.D8P6F9wK.js";const A=(e,a)=>{var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){var e=document.createElement("canvas");e.width=l.width,e.height=l.height,e.getContext("2d").drawImage(l,0,0,l.width,l.height);var t=e.toDataURL("image/png"),s=document.createElement("a"),n=new MouseEvent("click");s.download=a||"photo",s.href=t,s.dispatchEvent(n)},l.src=e},S={class:"flex gap-4 p-2"},U={class:"flex-none w-64 bg-white text-slate-700 dark:text-slate-400 dark:bg-slate-900 rounded p-4"},z={class:"flex-1 bg-white text-slate-700 dark:text-slate-400 dark:bg-slate-900"},T={class:"gva-table-box mt-0 mb-0"},M={class:"gva-btn-list gap-3"},P=["onClick"],R={class:"gva-pagination"},L=Object.assign({name:"Upload"},{__name:"upload",setup(L){const F=p(!1),N=p("/api"),q=p(""),K=p(""),Q=p(1),G=p(0),H=p(10),J=p({keyword:null,classId:0}),W=p([]),X=e=>{H.value=e,$()},Y=e=>{Q.value=e,$()},Z=()=>{J.value.classId=0,Q.value=1,$()},$=async()=>{const e=await s({page:Q.value,pageSize:H.value,...J.value});0===e.code&&(W.value=e.data.list,G.value=e.data.total,Q.value=e.data.page,H.value=e.data.pageSize)};$();const ee=()=>{V.prompt("格式：文件名|链接或者仅链接。","导入",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"我的图片|https://my-oss.com/my.png\nhttps://my-oss.com/my_1.png",inputPattern:/\S/,inputErrorMessage:"不能为空"}).then((async({value:e})=>{let a=e.split("\n"),l=[];a.forEach((e=>{let a,t,s=e.trim().split("|");if(s.length>1)t=s[0].trim(),a=s[1];else{a=s[0].trim();let e=a.substring(a.lastIndexOf("/")+1);t=e.substring(0,e.lastIndexOf("."))}a&&l.push({name:t,url:a,classId:J.value.classId,tag:a.substring(a.lastIndexOf(".")+1),key:O()})}));0===(await r(l)).code&&(E({type:"success",message:"导入成功!"}),await $())})).catch((()=>{E({type:"info",message:"取消导入"})}))},ae=()=>{J.value.keyword=null,Q.value=1,$()},le={children:"children",label:"name",value:"ID"},te=p([]),se=async()=>{const e=await n();let a={name:"全部分类",ID:0,pid:0,children:[]};0===e.code&&(te.value=e.data||[],te.value.unshift(a))},ne=e=>{J.value.keyword=null,J.value.classId=e.ID,Q.value=1,$()},oe=p(!1),ie=p({ID:0,pid:0,name:""}),ue=p(null),de=p({name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{max:20,message:"最多20位字符",trigger:"blur"}]}),re=async()=>{ue.value.validate((async e=>{if(e){0===(await d(ie.value)).code&&(E({type:"success",message:"操作成功"}),await se(),ce())}}))},ce=()=>{oe.value=!1,ie.value={ID:0,pid:0,name:""}};return se(),(s,n)=>{const d=m("MoreFilled"),r=m("el-icon"),p=m("Plus"),O=m("el-dropdown-item"),L=m("el-dropdown-menu"),pe=m("el-dropdown"),me=m("el-tree"),ve=m("el-scrollbar"),ge=m("el-button"),fe=m("el-input"),we=m("el-table-column"),he=m("el-tag"),ye=m("el-table"),Ie=m("el-pagination"),ke=m("el-tree-select"),xe=m("el-form-item"),be=m("el-form"),Ce=m("el-dialog"),_e=v("loading");return g((w(),f("div",null,[h("div",S,[h("div",U,[y(ve,{style:{height:"calc(100vh - 300px)"}},{default:I((()=>[y(me,{data:te.value,"node-key":"id",props:le,onNodeClick:ne,"default-expand-all":""},{default:I((({node:e,data:a})=>[h("div",{class:k(["w-36",J.value.classId===a.ID?"text-blue-500 font-bold":""])},x(a.name),3),y(pe,null,{dropdown:I((()=>[y(L,null,{default:I((()=>[y(O,{onClick:e=>{return l=a,oe.value=!0,ie.value.ID=0,void(ie.value.pid=l.ID);var l}},{default:I((()=>n[4]||(n[4]=[_("添加分类")]))),_:2},1032,["onClick"]),a.ID>0?(w(),b(O,{key:0,onClick:e=>{return l=a,ie.value={ID:l.ID,pid:l.pid,name:l.name},void(oe.value=!0);var l}},{default:I((()=>n[5]||(n[5]=[_("编辑分类")]))),_:2},1032,["onClick"])):C("",!0),a.ID>0?(w(),b(O,{key:1,onClick:e=>(async e=>{0===(await o({id:e})).code&&(E.success({type:"success",message:"删除成功"}),await se())})(a.ID)},{default:I((()=>n[6]||(n[6]=[_("删除分类")]))),_:2},1032,["onClick"])):C("",!0)])),_:2},1024)])),default:I((()=>[a.ID>0?(w(),b(r,{key:0,class:"ml-3 text-right"},{default:I((()=>[y(d)])),_:1})):(w(),b(r,{key:1,class:"ml-3 text-right mt-1"},{default:I((()=>[y(p)])),_:1}))])),_:2},1024)])),_:1},8,["data"])])),_:1})]),h("div",z,[h("div",T,[y(j,{title:"点击“文件名”可以编辑；选择的类别即是上传的类别。"}),h("div",M,[y(e,{"image-common":K.value,classId:J.value.classId,onOnSuccess:ae},null,8,["image-common","classId"]),y(a,{classId:J.value.classId,onOnSuccess:ae},null,8,["classId"]),y(l,{classId:J.value.classId,onOnSuccess:ae},null,8,["classId"]),y(t,{"image-url":q.value,"file-size":512,"max-w-h":1080,classId:J.value.classId,onOnSuccess:ae},null,8,["image-url","classId"]),y(ge,{type:"primary",icon:"upload",onClick:ee},{default:I((()=>n[7]||(n[7]=[_(" 导入URL ")]))),_:1}),y(fe,{modelValue:J.value.keyword,"onUpdate:modelValue":n[0]||(n[0]=e=>J.value.keyword=e),class:"w-72",placeholder:"请输入文件名或备注"},null,8,["modelValue"]),y(ge,{type:"primary",icon:"search",onClick:Z},{default:I((()=>n[8]||(n[8]=[_("查询 ")]))),_:1})]),y(ye,{data:W.value},{default:I((()=>[y(we,{align:"left",label:"预览",width:"100"},{default:I((e=>[y(c,{"pic-type":"file","pic-src":e.row.url,preview:""},null,8,["pic-src"])])),_:1}),y(we,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:I((e=>[h("div",null,x(D(B)(e.row.UpdatedAt)),1)])),_:1}),y(we,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:I((e=>[h("div",{class:"cursor-pointer",onClick:a=>(async e=>{V.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await i(e)).code&&(E({type:"success",message:"编辑成功!"}),await $())})).catch((()=>{E({type:"info",message:"取消修改"})}))})(e.row)},x(e.row.name),9,P)])),_:1}),y(we,{align:"left",label:"链接",prop:"url","min-width":"300"}),y(we,{align:"left",label:"标签",prop:"tag",width:"100"},{default:I((e=>{var a;return[y(he,{type:"jpg"===(null==(a=e.row.tag)?void 0:a.toLowerCase())?"info":"success","disable-transitions":""},{default:I((()=>[_(x(e.row.tag),1)])),_:2},1032,["type"])]})),_:1}),y(we,{align:"left",label:"操作",width:"160"},{default:I((e=>[y(ge,{icon:"download",type:"primary",link:"",onClick:a=>{var l;(l=e.row).url.indexOf("http://")>-1||l.url.indexOf("https://")>-1?A(l.url,l.name):A(N.value+"/"+l.url,l.name)}},{default:I((()=>n[9]||(n[9]=[_("下载 ")]))),_:2},1032,["onClick"]),y(ge,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{V.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await u(e)).code&&(E({type:"success",message:"删除成功!"}),1===W.value.length&&Q.value>1&&Q.value--,await $())})).catch((()=>{E({type:"info",message:"已取消删除"})}))})(e.row)},{default:I((()=>n[10]||(n[10]=[_("删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),h("div",R,[y(Ie,{"current-page":Q.value,"page-size":H.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:G.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:Y,onSizeChange:X},null,8,["current-page","page-size","total"])])])])]),y(Ce,{modelValue:oe.value,"onUpdate:modelValue":n[3]||(n[3]=e=>oe.value=e),onClose:ce,width:"520",title:(0===ie.value.ID?"添加":"编辑")+"分类",draggable:""},{footer:I((()=>[y(ge,{onClick:ce},{default:I((()=>n[11]||(n[11]=[_("取消")]))),_:1}),y(ge,{type:"primary",onClick:re},{default:I((()=>n[12]||(n[12]=[_("确定")]))),_:1})])),default:I((()=>[y(be,{ref_key:"categoryForm",ref:ue,rules:de.value,model:ie.value,"label-width":"80px"},{default:I((()=>[y(xe,{label:"上级分类"},{default:I((()=>[y(ke,{modelValue:ie.value.pid,"onUpdate:modelValue":n[1]||(n[1]=e=>ie.value.pid=e),data:te.value,"check-strictly":"",props:le,"render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data"])])),_:1}),y(xe,{label:"分类名称",prop:"name"},{default:I((()=>[y(fe,{modelValue:ie.value.name,"onUpdate:modelValue":n[2]||(n[2]=e=>ie.value.name=e),modelModifiers:{trim:!0},placeholder:"分类名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue","title"])])),[[_e,F.value,void 0,{fullscreen:!0,lock:!0}]])}}});export{L as default};
